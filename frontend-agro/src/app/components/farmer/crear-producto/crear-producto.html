<div class="crear-layout">

  <div class="crear-header">
    <a routerLink="/mis-productos" class="back-btn">
      <i class="fa-solid fa-arrow-left"></i> Mis Productos
    </a>
    <h1 class="crear-title">Crear Producto</h1>
    <p class="crear-subtitle">Rellena los datos y sube fotos de tu producto.</p>
  </div>

  <div class="crear-card">

    <!-- Error -->
    <div class="alert-error" *ngIf="error">
      <i class="fa-solid fa-circle-exclamation"></i> {{ error }}
    </div>

    <form (ngSubmit)="guardar()" #f="ngForm">

      <div class="form-grid">

        <!-- Nombre -->
        <div class="form-group full">
          <label>Nombre del producto <span class="req">*</span></label>
          <input type="text" class="form-input" placeholder="Ej: Tomates cherry ecológicos"
            [(ngModel)]="form.name" name="name" required>
        </div>

        <!-- Descripción -->
        <div class="form-group full">
          <label>Descripción <span class="req">*</span></label>
          <textarea class="form-input textarea" rows="3"
            placeholder="Describe tu producto..."
            [(ngModel)]="form.description" name="description" required></textarea>
        </div>

        <!-- Categoría -->
        <div class="form-group">
          <label>Categoría <span class="req">*</span></label>
          <mat-form-field appearance="outline" class="full-width theme-green" subscriptSizing="dynamic">
            <mat-select panelClass="panel-green" [(ngModel)]="form.category_id" name="category_id">
              <mat-option *ngFor="let cat of categorias" [value]="cat.id">
                {{ cat.icon }} {{ cat.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Unidad -->
        <div class="form-group">
          <label>Unidad de venta <span class="req">*</span></label>
          <mat-form-field appearance="outline" class="full-width theme-blue" subscriptSizing="dynamic">
            <mat-select panelClass="panel-blue" [(ngModel)]="form.unit" name="unit">
              <mat-option *ngFor="let u of unidades" [value]="u.value">
                {{ u.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Precio -->
        <div class="form-group">
          <label>Precio (€) <span class="req">*</span></label>
          <input type="number" class="form-input" placeholder="0.00" min="0" step="0.01"
            [(ngModel)]="form.price" name="price" required>
        </div>

        <!-- Stock -->
        <div class="form-group">
          <label>Stock disponible <span class="req">*</span></label>
          <input type="number" class="form-input" placeholder="0" min="0"
            [(ngModel)]="form.stock_quantity" name="stock_quantity" required>
        </div>

        <!-- Fecha fin temporada -->
        <div class="form-group full">
          <label>Fin de temporada <span class="optional">(opcional)</span></label>
          <input type="date" class="form-input"
            [(ngModel)]="form.season_end" name="season_end">
        </div>

      </div>

      <!-- Imágenes -->
      <div class="form-group full">
        <label>Fotos del producto <span class="optional">(máx. 4)</span></label>

        <label class="upload-area" for="imgInput">
          <i class="fa-solid fa-cloud-arrow-up"></i>
          <span>Arrastra o haz clic para subir fotos</span>
          <span class="upload-hint">JPG, PNG, WEBP — máx. 2MB por foto</span>
        </label>
        <input id="imgInput" type="file" multiple accept="image/*"
          (change)="onImagenesSeleccionadas($event)" style="display:none">

        <!-- Preview -->
        <div class="preview-grid" *ngIf="preview.length > 0">
          <div class="preview-item" *ngFor="let src of preview; let i = index">
            <img [src]="src" alt="Preview">
            <button type="button" class="remove-img" (click)="eliminarImagen(i)">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Acciones -->
      <div class="form-actions">
        <button type="button" class="btn-cancel" routerLink="/mis-productos">
          Cancelar
        </button>
        <button type="submit" class="btn-save" [disabled]="isLoading">
          <i class="fa-solid fa-spinner fa-spin" *ngIf="isLoading"></i>
          <i class="fa-solid fa-check" *ngIf="!isLoading"></i>
          {{ isLoading ? 'Guardando...' : 'Publicar Producto' }}
        </button>
      </div>

    </form>
  </div>
</div>
