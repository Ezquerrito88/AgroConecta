<div class="crear-layout">

  <!-- Header -->
  <div class="crear-header">
    <a routerLink="/mis-productos" class="back-btn">
      <i class="fa-solid fa-arrow-left"></i> Mis Productos
    </a>
    <div class="header-content">
      <div class="header-icon">ðŸŒ±</div>
      <div>
        <h1 class="crear-title">Publicar Producto</h1>
        <p class="crear-subtitle">Tu producto se publica inmediatamente en tu perfil</p>
      </div>
    </div>
  </div>

  <!-- Error -->
  <div class="alert-error" *ngIf="error">
    <i class="fa-solid fa-circle-exclamation"></i> {{ error }}
  </div>

  <form (ngSubmit)="guardar()" #f="ngForm">
    <div class="crear-body">

      <!-- COLUMNA IZQUIERDA -->
      <div class="col-main">

        <!-- InformaciÃ³n bÃ¡sica -->
        <div class="section-card">
          <div class="section-header">
            <span class="section-icon">ðŸ“‹</span>
            <h2 class="section-title">InformaciÃ³n bÃ¡sica</h2>
          </div>

          <!-- Nombre -->
          <div class="form-group">
            <label>Nombre del producto <span class="req">*</span></label>
            <input type="text" class="form-input"
              placeholder="Ej: Tomates cherry ecolÃ³gicos"
              [(ngModel)]="form.name" name="name" required>
          </div>

          <!-- DescripciÃ³n corta (para cards) -->
          <div class="form-group">
            <label>DescripciÃ³n corta <span class="req">*</span></label>
            <p class="field-hint">Aparece en las tarjetas de productos (mÃ¡x. 80 caracteres)</p>
            <input type="text" class="form-input"
              placeholder="Ej: Tomates cherry rojos, dulces y reciÃ©n cosechados"
              [(ngModel)]="form.short_description" name="short_description" maxlength="80" required>
            <small class="char-count">{{ form.short_description?.length || 0 }}/80</small>
          </div>

          <!-- DescripciÃ³n larga -->
          <div class="form-group">
            <label>DescripciÃ³n completa <span class="req">*</span></label>
            <p class="field-hint">Detalles completos para la pÃ¡gina del producto</p>
            <textarea class="form-input textarea" rows="4"
              placeholder="Describe tu producto: origen, mÃ©todo de cultivo, caracterÃ­sticas..."
              [(ngModel)]="form.description" name="description" required></textarea>
          </div>

          <div class="form-row">

            <!-- CategorÃ­a (estilo filtros) -->
            <div class="form-group filter-group filter-green">
              <label><span class="dot-green"></span> CategorÃ­a <span class="req">*</span></label>
              <mat-form-field appearance="outline" class="full-width theme-green" subscriptSizing="dynamic">
                <mat-select panelClass="panel-green" [(ngModel)]="form.category_id" name="category_id">
                  <mat-option *ngFor="let cat of categorias" [value]="cat.id">
                    {{ cat.icon }} {{ cat.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Unidad (estilo filtros) -->
            <div class="form-group filter-group filter-blue">
              <label><span class="dot-blue"></span> Unidad de venta <span class="req">*</span></label>
              <mat-form-field appearance="outline" class="full-width theme-blue" subscriptSizing="dynamic">
                <mat-select panelClass="panel-blue" [(ngModel)]="form.unit" name="unit">
                  <mat-option *ngFor="let u of unidades" [value]="u.value">
                    {{ u.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

          </div>
        </div>

        <!-- Fotos -->
        <div class="section-card">
          <div class="section-header">
            <span class="section-icon">ðŸ“¸</span>
            <h2 class="section-title">Fotos del producto</h2>
            <span class="section-badge">mÃ¡x. 4 fotos</span>
          </div>

          <label class="upload-area" for="imgInput">
            <div class="upload-icon-wrap">
              <i class="fa-solid fa-cloud-arrow-up"></i>
            </div>
            <span class="upload-text">Arrastra o haz clic para subir fotos</span>
            <span class="upload-hint">JPG, PNG, WEBP â€” mÃ¡x. 2MB por foto</span>
          </label>
          <input id="imgInput" type="file" multiple accept="image/*"
            (change)="onImagenesSeleccionadas($event)" style="display:none">

          <div class="preview-grid" *ngIf="preview.length > 0">
            <div class="preview-item" *ngFor="let src of preview; let i = index">
              <img [src]="src" alt="Preview">
              <button type="button" class="remove-img" (click)="eliminarImagen(i)">
                <i class="fa-solid fa-xmark"></i>
              </button>
              <div class="preview-badge" *ngIf="i === 0">Principal</div>
            </div>
          </div>
        </div>

      </div>

      <!-- COLUMNA DERECHA -->
      <div class="col-side">

        <!-- Precio y stock -->
        <div class="section-card">
          <div class="section-header">
            <span class="section-icon">ðŸ’°</span>
            <h2 class="section-title">Precio y stock</h2>
          </div>

          <div class="form-group">
            <label>Precio (â‚¬) <span class="req">*</span></label>
            <div class="input-prefix-wrap">
              <span class="input-prefix">â‚¬</span>
              <input type="number" class="form-input with-prefix"
                placeholder="0.00" min="0" step="0.01"
                [(ngModel)]="form.price" name="price" required>
            </div>
          </div>

          <div class="form-group">
            <label>Stock disponible <span class="req">*</span></label>
            <div class="input-prefix-wrap">
              <span class="input-prefix">ðŸ“¦</span>
              <input type="number" class="form-input with-prefix"
                placeholder="0" min="0"
                [(ngModel)]="form.stock_quantity" name="stock_quantity" required>
            </div>
          </div>
        </div>

        <!-- Temporada -->
        <div class="section-card">
          <div class="section-header">
            <span class="section-icon">ðŸ“…</span>
            <h2 class="section-title">Temporada</h2>
          </div>

          <div class="form-group">
            <label>Fin de temporada <span class="optional">(opcional)</span></label>
            <input type="date" class="form-input"
              [(ngModel)]="form.season_end" name="season_end">
          </div>

          <div class="season-tip">
            <i class="fa-solid fa-circle-info"></i>
            Indica cuÃ¡ndo termina la disponibilidad de este producto.
          </div>
        </div>

        <!-- Publicar -->
        <div class="section-card publish-card">
          <div class="publish-status success">
            <i class="fa-solid fa-circle-check"></i>
            <div>
              <strong>Â¡Producto publicado!</strong>
              <p>Se mostrarÃ¡ inmediatamente en tu perfil de agricultor. Un admin puede revisarlo despuÃ©s.</p>
            </div>
          </div>

          <button type="submit" class="btn-save" [disabled]="isLoading">
            <i class="fa-solid fa-spinner fa-spin" *ngIf="isLoading"></i>
            <i class="fa-solid fa-seedling" *ngIf="!isLoading"></i>
            {{ isLoading ? 'Publicando...' : 'Publicar Producto' }}
          </button>

          <button type="button" class="btn-cancel" routerLink="/mis-productos">
            Cancelar
          </button>
        </div>

      </div>
    </div>
  </form>
</div>
