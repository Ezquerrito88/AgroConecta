<section class="hero-banner">
  <div class="banner-content">
    <div class="badge-fresco">
      <span class="emoji">üå±</span> Cosecha Fresca Diaria
    </div>
    <h1 class="main-title">
      Sabores que <span class="text-green">Conectan</span>
    </h1>
    <p class="main-subtitle">
      Descubre productos √∫nicos directamente de la mano de quienes los cultivan con amor.
    </p>
    <div class="benefits-row">
      <div class="pill"><span class="dot dot-green"></span> Entrega en 48h</div>
      <div class="pill"><span class="dot dot-orange"></span> Directo del campo</div>
      <div class="pill"><span class="dot dot-blue"></span> Precios justos</div>
    </div>
  </div>
</section>

<section class="products-section" id="inicio-lista">
  <div class="category-pills">
    <button *ngFor="let cat of categoriasRapidas" class="cat-btn"
      [class.active]="filtros.categoria === cat.toLowerCase()" (click)="seleccionarCategoriaRapida(cat)">
      {{ cat }}
    </button>
  </div>

  <div class="main-layout">
    <aside class="filter-card">
      <div class="filter-header">
        <h3>Filtros</h3>
        <button class="clear-filters-btn" (click)="limpiarFiltros()">
          <i class="fa-solid fa-filter-circle-xmark"></i>
        </button>
      </div>

      <div class="filter-group filter-blue">
        <label><span class="dot-blue"></span> Ordenar por</label>
        <mat-form-field appearance="outline" class="full-width theme-blue" subscriptSizing="dynamic">
          <mat-select panelClass="panel-blue" value="Destacados">
            <mat-option value="Destacados">Destacados</mat-option>
            <mat-option value="asc">Precio: Menor a Mayor</mat-option>
            <mat-option value="desc">Precio: Mayor a Menor</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="filter-group filter-green">
        <label><span class="dot-green"></span> Categor√≠a</label>
        <mat-form-field appearance="outline" class="full-width theme-green" subscriptSizing="dynamic">
          <mat-select panelClass="panel-green" value="Todas">
            <mat-option value="Todas">Todas</mat-option>
            <mat-option value="Frutas">Frutas</mat-option>
            <mat-option value="Verduras">Verduras</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="filter-group filter-orange">
        <label><span class="dot-orange"></span> Rango de Precio</label>

        <div class="slider-container">
          <mat-slider min="0" max="100" step="1">
            <input matSliderStartThumb [(ngModel)]="minPrice" (dragEnd)="filtrarPorPrecio()">
            <input matSliderEndThumb [(ngModel)]="maxPrice" (dragEnd)="filtrarPorPrecio()">
          </mat-slider>
        </div>

        <div class="range-labels">
          <span class="price-tag min">{{ minPrice }}‚Ç¨</span>
          <span class="price-tag max">{{ maxPrice }}‚Ç¨</span>
        </div>
      </div>
    </aside>

    <main class="products-grid-container">

      @if (isLoading) {
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Buscando los mejores productos...</p>
      </div>
      }

      @else {

      <div class="grid-header">
        <h2>Selecci√≥n fresca del d√≠a</h2>
        <span class="results-count">P√°gina {{ paginaActual }} de 2</span>
      </div>

      <div class="products-grid">
        <div class="product-card" *ngFor="let prod of productos" [routerLink]="['/producto', prod.id]"
          style="cursor: pointer;">

          <div class="card-image">
            <div class="stock-badge" *ngIf="prod.stock_quantity <= 5" [class.no-stock]="prod.stock_quantity === 0">
              {{ prod.stock_quantity === 0 ? 'Agotado' : '¬°Casi agotado!' }}
            </div>

            <button class="wishlist-btn" [class.active]="prod.is_favorite"
              (click)="$event.stopPropagation(); toggleFavorite(prod)">
              <i [class]="prod.is_favorite ? 'fa-solid fa-heart' : 'fa-regular fa-heart'"></i>
            </button>

            <img *ngIf="prod.images && prod.images.length > 0"
              [src]="'https://agroconecta-backend-v2-bxbxfudaatbmgxdg.spaincentral-01.azurewebsites.net/storage/' + prod.images[0].image_path"
              alt="{{ prod.name }}">

            <div *ngIf="!prod.images || prod.images.length === 0" class="placeholder-img">
              <i class="fa-solid fa-image"></i>
            </div>
          </div>

          <div class="card-content">

            <h4 class="product-title">
              {{ prod.name }}
            </h4>

            <p class="short-desc" *ngIf="prod.short_description">
              {{ prod.short_description }}
            </p>

            <div class="seller-box" *ngIf="prod.farmer">
              <span class="seller-name">{{ prod.farmer.full_name || 'Agricultor Local' }}</span>
              <span class="seller-location"><i class="fa-solid fa-location-dot"></i> Logro√±o</span>
            </div>

            <div class="card-footer">
              <div class="price-box">
                <span class="price-main">{{ prod.price }}‚Ç¨</span>
                <span class="price-unit">/{{ prod.unit }}</span>
              </div>

              <button class="add-button" [disabled]="prod.stock_quantity === 0"
                (click)="$event.stopPropagation(); addToCart(prod)"> <i class="fa-solid fa-plus"></i> A√±adir
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="pagination-container" *ngIf="totalPaginas > 1">
        <div class="pagination-controls">

          <button type="button" class="pag-btn nav-btn" [disabled]="paginaActual === 1"
            (click)="cambiarPagina(paginaActual - 1)">
            <i class="fa-solid fa-chevron-left"></i>
          </button>

          <button type="button" class="pag-btn num-btn" [class.active]="paginaActual === 1" (click)="cambiarPagina(1)">
            1
          </button>

          <button *ngIf="totalPaginas >= 2" type="button" class="pag-btn num-btn" [class.active]="paginaActual === 2"
            (click)="cambiarPagina(2)">
            2
          </button>

          <button type="button" class="pag-btn nav-btn" [disabled]="paginaActual === 2 || paginaActual >= totalPaginas"
            (click)="cambiarPagina(paginaActual + 1)">
            <i class="fa-solid fa-chevron-right"></i>
          </button>

        </div>
      </div>

      <div class="pagination-info" *ngIf="productos.length > 0">
        Mostrando
        <span class="numbers">{{ ((paginaActual - 1) * itemsPorPagina) + 1 }}</span>
        -
        <span class="numbers">{{ ((paginaActual - 1) * itemsPorPagina) + productos.length }}</span>
        de
        <span class="numbers">12</span>
        productos.
      </div>

      <div style="text-align: center; margin-top: 20px;">
        <button type="button" class="btn-full-catalog" (click)="irAlCatalogoCompleto()">
          Ver Cat√°logo Completo
        </button>
      </div>

      }
    </main>
  </div>
</section>